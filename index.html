<!DOCTYPE html>
<html lang="ka">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>წყლის კალკულატორი + ტალღები</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      margin: 0;
      overflow: hidden;
      background-color: white;
      color: black;
      transform: scale(0.75);
      transform-origin: top center;
    }
    canvas {
      display: block;
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 100vh;
      z-index: 1;
      transition: height 1s ease-in-out, top 1s ease-in-out;
    }
    .calculator-container {
      position: relative;
      z-index: 20;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 20px;
    }
    #results p {
      font-weight: normal;
      font-size: 1rem;
      margin-bottom: 0.5rem;
      color: white;
    }
  </style>
</head>
<body class="min-h-screen relative bg-white text-black">

  <div class="calculator-container">
    <div class="calculator bg-[#4f8292] border border-white/30 p-6 rounded-xl shadow-2xl w-11/12 sm:w-96 md:w-1/2 lg:w-96 xl:w-1/3 max-w-lg text-center backdrop-blur-sm">
      <h2 class="mb-4 text-white font-bold" style="font-size: 1.4rem;">
        წყლის კალკულატორი
      </h2>

      <select id="gender" class="w-full p-2 my-2 rounded-md bg-[#3d5a63] text-white placeholder-white focus:outline-none focus:ring-2 focus:ring-blue-400 transition-all duration-200">
        <option value="male">კაცი</option>
        <option value="female">ქალი</option>
      </select>

      <input type="number" id="height" placeholder="სიმაღლე (სმ)" class="w-full p-2 my-2 rounded-md bg-[#3d5a63] text-white placeholder-white focus:outline-none focus:ring-2 focus:ring-blue-400 transition-all duration-200" />
      <input type="number" id="weight" placeholder="წონა (კგ)" class="w-full p-2 my-2 rounded-md bg-[#3d5a63] text-white placeholder-white focus:outline-none focus:ring-2 focus:ring-blue-400 transition-all duration-200" />
      <input type="number" id="cupVolume" placeholder="ჭიქის მოცულობა (მლ)" class="w-full p-2 my-2 rounded-md bg-[#3d5a63] text-white placeholder-white focus:outline-none focus:ring-2 focus:ring-blue-400 transition-all duration-200" />
      <input type="number" id="cupsDrunk" placeholder="დალეული ჭიქების რაოდენობა" class="w-full p-2 my-2 rounded-md bg-[#3d5a63] text-white placeholder-white focus:outline-none focus:ring-2 focus:ring-blue-400 transition-all duration-200" />

      <button onclick="calculateWater()" style="background-color: #67a5a5;" class="mt-4 w-full py-2 px-4 text-white font-bold rounded-md shadow-lg transition-colors duration-300 transform hover:scale-105 hover:opacity-90">
        გამოთვლა
      </button>

      <div id="results" class="result-box mt-6 pt-4 border-t border-white/30 text-white">
      </div>

      <div id="error-message" class="hidden mt-4 p-3 bg-red-600 text-white rounded-md text-sm"></div>
    </div>
  </div>

  <canvas id="waveCanvas"></canvas>

  <script>
    const canvas = document.getElementById('waveCanvas');
    const ctx = canvas.getContext('2d');
    const body = document.body;

    let waterFillPercentage = 0;
    let time = 0;

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    function drawWave(amplitude, frequency, speed, phaseShift, color, baseLevelY) {
      ctx.beginPath();
      ctx.moveTo(0, baseLevelY + amplitude * Math.sin(0 * frequency + time * speed + phaseShift));
      for (let x = 0; x <= canvas.width; x++) {
        const y = amplitude * Math.sin((x * frequency) + time * speed + phaseShift) + baseLevelY;
        ctx.lineTo(x, y);
      }
      ctx.lineTo(canvas.width, canvas.height);
      ctx.lineTo(0, canvas.height);
      ctx.closePath();
      ctx.fillStyle = color;
      ctx.fill();
    }

    function animate() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      const bottomOffset = 50; // 50 px from bottom

      // დალეული პროცენტის მიხედვით გამოითვლება ტალღის Y ბაზა
      const baseWaveY = canvas.height - bottomOffset - ((canvas.height - bottomOffset) * (waterFillPercentage / 100));

      drawWave(15, 0.015, 0.03, 0, '#5f93a4', baseWaveY);
      drawWave(12, 0.02, -0.025, Math.PI / 2, '#3f7384', baseWaveY + 10);
      drawWave(10, 0.025, 0.02, Math.PI, '#71b0c4', baseWaveY + 20);
      drawWave(8, 0.03, -0.015, Math.PI * 1.5, '#3987a0', baseWaveY + 30);

      time += 0.5;
      requestAnimationFrame(animate);
    }

    window.onload = () => {
      animate();
    };

    function showMessage(message, isError = true) {
      const errorMessageDiv = document.getElementById('error-message');
      errorMessageDiv.textContent = message;
      errorMessageDiv.classList.remove('hidden', 'bg-red-600', 'bg-green-600');
      errorMessageDiv.classList.add(isError ? 'bg-red-600' : 'bg-green-600');
      setTimeout(() => {
        errorMessageDiv.classList.add('hidden');
      }, 5000);
    }

    function calculateWater() {
      const gender = document.getElementById('gender').value;
      const height = parseFloat(document.getElementById('height').value);
      const weight = parseFloat(document.getElementById('weight').value);
      const cupVolume = parseFloat(document.getElementById('cupVolume').value);
      const cupsDrunk = parseFloat(document.getElementById('cupsDrunk').value);
      const resultsDiv = document.getElementById('results');

      if (isNaN(height) || height <= 0) {
        showMessage('გთხოვთ, შეიყვანოთ სწორი დადებითი სიმაღლე.');
        resultsDiv.innerHTML = '';
        return;
      }
      if (isNaN(weight) || weight <= 0) {
        showMessage('გთხოვთ, შეიყვანოთ სწორი დადებითი წონა.');
        resultsDiv.innerHTML = '';
        return;
      }
      if (isNaN(cupVolume) || cupVolume <= 0) {
        showMessage('გთხოვთ, შეიყვანოთ სწორი დადებითი ჭიქის მოცულობა.');
        resultsDiv.innerHTML = '';
        return;
      }
      if (isNaN(cupsDrunk) || cupsDrunk < 0) {
        showMessage('გთხოვთ, შეიყვანოთ დალეული ჭიქების სწორი, არაუარყოფითი რაოდენობა.');
        resultsDiv.innerHTML = '';
        return;
      }

      let requiredMl;
      if (gender === 'male') {
        requiredMl = (weight * 35) + (height * 4);
      } else {
        requiredMl = (weight * 31) + (height * 3.5);
      }

      let drunkMl = cupsDrunk * cupVolume;
      let remainingMl = requiredMl - drunkMl;

      if (requiredMl > 0) {
        waterFillPercentage = (drunkMl / requiredMl) * 100;
      } else {
        waterFillPercentage = 0;
      }

      let remainingColorClass = '';
      let remainingText = '';

      if (remainingMl > 0) {
        remainingColorClass = 'text-red-400';
        remainingText = `<strong>დარჩენილი:</strong> ${Math.round(remainingMl)} მლ / ${Math.round(remainingMl / cupVolume)} ჭიქა`;
      } else {
        remainingColorClass = 'text-green-400';
        remainingText = `<strong>ზედმეტი:</strong> ${Math.abs(Math.round(remainingMl))} მლ / ${Math.abs(Math.round(remainingMl / cupVolume))} ჭიქა`;
      }

      let resultText = `
        <p><strong>საჭირო რაოდენობა:</strong> ${Math.round(requiredMl)} მლ / ${Math.round(requiredMl / cupVolume)} ჭიქა</p>
        <p><strong>დალეული:</strong> ${Math.round(drunkMl)} მლ / ${Math.round(drunkMl / cupVolume)} ჭიქა</p>
        <p class="${remainingColorClass}">${remainingText}</p>
      `;

      resultsDiv.innerHTML = resultText;
    }
  </script>
</body>
</html>
